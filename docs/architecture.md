# ComfyUI-SimpleChat Architecture Design

## Design Philosophy

**Do one thing, do best** - æ¯ä¸ªèŠ‚ç‚¹åªåšä¸€ä»¶äº‹ï¼Œåšåˆ°æè‡´ã€‚

## èŠ‚ç‚¹è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**: æ¯ä¸ªèŠ‚ç‚¹åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
2. **æ¸…æ™°å‘½å**: èŠ‚ç‚¹åç§°ç›´æ¥è¡¨è¾¾åŠŸèƒ½
3. **æœ€å°‘é…ç½®**: åˆç†é»˜è®¤å€¼ï¼Œå‡å°‘å¿…å¡«é¡¹
4. **ç¾è§‚å¸ƒå±€**: è¾“å…¥è¾“å‡ºé¡ºåºç¬¦åˆç›´è§‰

---

## èŠ‚ç‚¹æ¸…å•

### é…ç½®èŠ‚ç‚¹

| èŠ‚ç‚¹ | åŠŸèƒ½ | è®¾è®¡ç†å¿µ |
|------|------|----------|
| `API Config` | é…ç½® API è¿æ¥ | ä¸€æ¬¡é…ç½®ï¼Œåˆ°å¤„ä½¿ç”¨ |

### å¯¹è¯èŠ‚ç‚¹

| èŠ‚ç‚¹ | åŠŸèƒ½ | è®¾è®¡ç†å¿µ |
|------|------|----------|
| `Chat` | åŸºç¡€å¯¹è¯ | æœ€ç®€å•çš„æ–‡æœ¬å¯¹è¯ |
| `Chat with Image` | å‘é€å›¾ç‰‡ç»™ LLM | è§†è§‰ç†è§£ |
| `Chat NoASS` | NoASS æ ¼å¼å¯¹è¯ | è§’è‰²æ‰®æ¼”ä¼˜åŒ– |

### å›¾ç‰‡ç”ŸæˆèŠ‚ç‚¹ (Gemini Only)

| èŠ‚ç‚¹ | åŠŸèƒ½ | è®¾è®¡ç†å¿µ |
|------|------|----------|
| `Gemini Image Gen` | æ–‡ç”Ÿå›¾ | çº¯æ–‡æœ¬ç”Ÿæˆå›¾ç‰‡ |
| `Gemini Image Edit` | å›¾ç‰‡ç¼–è¾‘ | åŸºäºå‚è€ƒå›¾ä¿®æ”¹ |

---

## èŠ‚ç‚¹è¯¦ç»†è®¾è®¡

### 1. API Config

**åŠŸèƒ½**: é…ç½® API è¿æ¥å‚æ•°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ”§ API Config              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  provider    [openai â–¼]             â”‚
â”‚  api_key     [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]           â”‚
â”‚  base_url    [                    ] â”‚
â”‚  model       [gpt-4o â–¼]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          CONFIG â—‹â”€â”€â”€â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¾“å…¥:**
- `provider`: ä¸‹æ‹‰ ["openai", "claude", "gemini"]
- `api_key`: å¯†ç è¾“å…¥
- `base_url`: æ–‡æœ¬ (å¯é€‰ï¼Œç•™ç©ºä½¿ç”¨é»˜è®¤)
- `model`: å¯ç¼–è¾‘ä¸‹æ‹‰

**è¾“å‡º:**
- `CONFIG`: é…ç½®å¯¹è±¡

---

### 2. Chat

**åŠŸèƒ½**: åŸºç¡€æ–‡æœ¬å¯¹è¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ğŸ’¬ Chat                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€â—‹ config                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  prompt      [                    ] â”‚
â”‚              [                    ] â”‚
â”‚  system      [                    ] â”‚
â”‚  temperature [1.0    ]              â”‚
â”‚  max_tokens  [2048   ]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            text â—‹â”€â”€â”€â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¾“å…¥:**
- `config`: CONFIG (å¿…éœ€)
- `prompt`: å¤šè¡Œæ–‡æœ¬
- `system`: ç³»ç»Ÿæç¤º (å¯é€‰)
- `temperature`: 0-2, é»˜è®¤ 1.0
- `max_tokens`: é»˜è®¤ 2048

**è¾“å‡º:**
- `text`: STRING

---

### 3. Chat with Image

**åŠŸèƒ½**: å‘é€å›¾ç‰‡ç»™ LLM åˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ğŸ–¼ï¸ Chat with Image           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€â—‹ config                         â”‚
â”‚ â”€â”€â”€â—‹ image                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  prompt      [Describe this image ] â”‚
â”‚              [                    ] â”‚
â”‚  system      [                    ] â”‚
â”‚  temperature [1.0    ]              â”‚
â”‚  max_tokens  [2048   ]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            text â—‹â”€â”€â”€â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¾“å…¥:**
- `config`: CONFIG
- `image`: IMAGE
- `prompt`: å¤šè¡Œæ–‡æœ¬
- `system`: ç³»ç»Ÿæç¤º (å¯é€‰)
- `temperature`: 0-2
- `max_tokens`: é»˜è®¤ 2048

**è¾“å‡º:**
- `text`: STRING

---

### 4. Chat NoASS

**åŠŸèƒ½**: NoASS æ ¼å¼çš„è§’è‰²æ‰®æ¼”å¯¹è¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ­ Chat NoASS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€â—‹ config                         â”‚
â”‚ â”€â”€â”€â—‹ history (optional)             â”‚
â”‚ â”€â”€â”€â—‹ image (optional)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  system      [You are...          ] â”‚
â”‚              [                    ] â”‚
â”‚  user_input  [                    ] â”‚
â”‚  user_name   [User    ]             â”‚
â”‚  char_name   [Assistant]            â”‚
â”‚  temperature [1.0    ]              â”‚
â”‚  max_tokens  [2048   ]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            text â—‹â”€â”€â”€â”‚
â”‚                         history â—‹â”€â”€â”€â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¾“å…¥:**
- `config`: CONFIG
- `history`: STRING (å¯é€‰ï¼Œä¸Šä¸€è½®è¾“å‡º)
- `image`: IMAGE (å¯é€‰)
- `system`: ç³»ç»Ÿæç¤º/ä¸–ç•Œè§‚è®¾å®š
- `user_input`: ç”¨æˆ·æœ¬è½®è¾“å…¥
- `user_name`: ç”¨æˆ·è§’è‰²å
- `char_name`: AI è§’è‰²å
- `temperature`: 0-2
- `max_tokens`: é»˜è®¤ 2048

**è¾“å‡º:**
- `text`: STRING (æœ¬è½® AI å›å¤)
- `history`: STRING (å®Œæ•´å¯¹è¯å†å²ï¼Œå¯è¿æ¥åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ history è¾“å…¥)

---

### 5. Gemini Image Gen

**åŠŸèƒ½**: Gemini æ–‡ç”Ÿå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ğŸ¨ Gemini Image Gen           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€â—‹ config (Gemini only)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  prompt      [A cat wearing a hat ] â”‚
â”‚              [                    ] â”‚
â”‚  aspect      [1:1 â–¼]                â”‚
â”‚  size        [1K â–¼]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           IMAGE â—‹â”€â”€â”€â”‚
â”‚                            text â—‹â”€â”€â”€â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¾“å…¥:**
- `config`: CONFIG (å¿…é¡»æ˜¯ Gemini provider)
- `prompt`: å¤šè¡Œæ–‡æœ¬
- `aspect`: ä¸‹æ‹‰ ["1:1", "16:9", "9:16", "4:3", "3:4"]
- `size`: ä¸‹æ‹‰ ["1K", "2K", "4K"]

**è¾“å‡º:**
- `IMAGE`: IMAGE
- `text`: STRING (Gemini çš„æ–‡å­—æè¿°)

---

### 6. Gemini Image Edit

**åŠŸèƒ½**: Gemini å›¾ç‰‡ç¼–è¾‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       âœï¸ Gemini Image Edit          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€â—‹ config (Gemini only)           â”‚
â”‚ â”€â”€â”€â—‹ image                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  prompt      [Add a red hat       ] â”‚
â”‚              [                    ] â”‚
â”‚  size        [1K â–¼]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           IMAGE â—‹â”€â”€â”€â”‚
â”‚                            text â—‹â”€â”€â”€â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¾“å…¥:**
- `config`: CONFIG (å¿…é¡»æ˜¯ Gemini provider)
- `image`: IMAGE (è¦ç¼–è¾‘çš„å›¾ç‰‡)
- `prompt`: ç¼–è¾‘æŒ‡ä»¤
- `size`: ä¸‹æ‹‰ ["1K", "2K", "4K"]

**è¾“å‡º:**
- `IMAGE`: IMAGE
- `text`: STRING

---

## æ•°æ®æµç¤ºä¾‹

### åŸºç¡€å¯¹è¯

```
[API Config] â”€â”€CONFIGâ”€â”€> [Chat] â”€â”€textâ”€â”€> [Display Text]
```

### å›¾ç‰‡åˆ†æ

```
[Load Image] â”€â”€IMAGEâ”€â”€â”
                      â”œâ”€â”€> [Chat with Image] â”€â”€textâ”€â”€> [Display Text]
[API Config] â”€â”€CONFIGâ”€â”˜
```

### å¤šè½® NoASS å¯¹è¯

```
[API Config] â”€â”€CONFIGâ”€â”€> [Chat NoASS] â”€â”€historyâ”€â”€> [Chat NoASS] â”€â”€historyâ”€â”€> ...
                              â”‚                         â”‚
                              â””â”€â”€textâ”€â”€>           â””â”€â”€textâ”€â”€>
```

### Gemini å›¾ç‰‡ç”Ÿæˆ

```
[API Config] â”€â”€CONFIGâ”€â”€> [Gemini Image Gen] â”€â”€IMAGEâ”€â”€> [Preview Image]
      â”‚                                           â”‚
      â”‚                                      â”€â”€textâ”€â”€> [Display Text]
```

---

## æ–‡ä»¶ç»“æ„

```
custom_nodes/ComfyUI-SimpleChat/
â”œâ”€â”€ __init__.py              # èŠ‚ç‚¹æ³¨å†Œ
â”œâ”€â”€ nodes/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py            # API Config
â”‚   â”œâ”€â”€ chat.py              # Chat
â”‚   â”œâ”€â”€ chat_image.py        # Chat with Image
â”‚   â”œâ”€â”€ chat_noass.py        # Chat NoASS
â”‚   â”œâ”€â”€ gemini_gen.py        # Gemini Image Gen
â”‚   â””â”€â”€ gemini_edit.py       # Gemini Image Edit
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py          # Provider æŠ½è±¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ openai.py        # OpenAI (+ å…¼å®¹ API)
â”‚   â”‚   â”œâ”€â”€ claude.py        # Claude/Anthropic
â”‚   â”‚   â””â”€â”€ gemini.py        # Google Gemini
â”‚   â”œâ”€â”€ noass.py             # NoASS æ ¼å¼å¤„ç†
â”‚   â””â”€â”€ image_utils.py       # å›¾ç‰‡è½¬æ¢
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

---

## å®ç°ä¼˜å…ˆçº§

1. **Phase 1**: API Config + Chat (æœ€å°å¯ç”¨)
2. **Phase 2**: Chat with Image
3. **Phase 3**: Chat NoASS
4. **Phase 4**: Gemini Image Gen/Edit
